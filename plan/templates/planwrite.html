{% extends "base.html" %}
{% load static %}
{% block title %}
<!-- 비회원 접근불가 로그인필요 -->
<input type="hidden" name="memid" value="{{memid}}">
<input type="hidden" name="social" value="{{user.is_authenticated}}">

<script>
	var memid = $("input[name='memid']").val();
	var social = $("input[name='social']").val();
	if((memid == "" || memid == "None") && social == "False"){
		alert("로그인이 필요합니다");
		location.href="/member/login";
	}
	
	function doNotReload(){
	    if(event.keyCode == 116) {
	      var conf = confirm("새로고침시 일정이 초기화 됩니다. 초기화 하시겠습니까?");
	      if(conf){
	    	  return true;
	      }else{
	    	  return false;
	      }
	    }
	}
	document.onkeydown = doNotReload;
</script>
{% endblock %}

{% block content %}
	<div class="hero hero-inner">
    	<div class="container">
      		<div class="row align-items-center">
        		<div class="col-lg-6 mx-auto text-center">
          			<div class="intro-wrap">
            			<h1 class="mb-0">일정 만들기</h1><br><br>              
          			</div>
        		</div>
      		</div>
			<table>
         		<h6 class="text-white text-center">나만의 일정을 만들어보세요</h6> 
      		</table>
    	</div>
  	</div>
  	<details class="container">
         <summary class=" text-center bg-white text-dark rounded">구 별 맛집 리스트 확인하기</summary>
      <div class="tpt">
         <div class="form-group">
            <div class="select-control">
               <label for="eatplace">장소 선택</label>
                <select class="form-control w-25" name="gu" id="eatplace" name="eatplace">
                  <option>구 선택</option>
                  <option value="1">강남구</option>
                  <option value="0">강동구</option>
                  <option value="2">강북구</option>
                  <option value="3">강서구</option>
                  <option value="4">관악구</option>
                  <option value="5">광진구</option>
                  <option value="6">구로구</option>
                  <option value="7">금천구</option>
                  <option value="8">노원구</option>
                  <option value="9">도봉구</option>
                  <option value="10">동대문구</option>
                  <option value="11">동작구</option>
                  <option value="12">마포구</option>
                  <option value="13">서대문구</option>
                  <option value="14">서초구</option>
                  <option value="15">성동구</option>
                  <option value="16">성북구</option>
                  <option value="17">송파구</option>
                  <option value="18">양천구</option>
                  <option value="19">영등포구</option>
                  <option value="20">용산구</option>
                  <option value="21">은평구</option>
                  <option value="22">종로구</option>
                  <option value="23">중구</option>
                  <option value="24">중랑구</option>
               </select>
            </div>
         </div>
         <div style="overflow:auto;">
            <table class="table mx-auto w-auto text-center text-black bg-white rounded" style="float:left;margin-right:15px!important;width : 32%!important;" id="eatlist1" border="1"></table>
            <table class="table rounded mx-auto w-auto text-center text-black bg-white" style="float:left;margin-right:15px!important;width : 32%!important;" id="eatlist2" border="1"></table>
            <table class="table rounded mx-auto w-auto text-center text-black bg-white" style="float:left;width : 32%!important;" id="eatlist3" border="1"></table>
         </div>
      </div>
   </details>
<script>
      $(document).ready(function(){
         $('#eatplace').on("change",function(){
            var gu = $('#eatplace option:selected').text()
            $.ajax({
               url:"/plan/planwrite",
               type:"POST",
               data : {'gu':gu, 'csrfmiddlewaretoken' : '{{csrf_token}}'},
               dataType: "json",
               success : function(data){
                  $("#eatlist1 *").remove();
                      var str = ""   
                      str += "<tr>"
                       str += "<td>순위</td>"
                       str += "<td>가게이름</td>"
                       str += "<td>평점</td>"
                       str += "</tr>"
                   for(var i=1;i<5;i++){
                     str += "<tr>"
                     str += "<td>"+i+"</td>"
                     str += "<td>"+data.ttname[i-1]+"</td>"
                     str += "<td><span class='text-warning'> ★ </span> "+data.ttstar[i-1]+"</td>"
                     str += "</tr>"
                  }
                   
                     $('#eatlist1').append(str)
               },
                error:function(request,status,error){
                   alert("fail");
                   alert("code:"+request.status+"\n"+"error:"+error);
                  }
            })
         })
      })
      $(document).ready(function(){
         $('#eatplace').on("change",function(){
            var gu = $('#eatplace option:selected').text()
            $.ajax({
               url:"/plan/planwrite",
               type:"POST",
               data : {'gu':gu, 'csrfmiddlewaretoken' : '{{csrf_token}}'},
               dataType: "json",
               success : function(data){
                  $("#eatlist2 *").remove();
                      var str = ""   
                      str += "<tr>"
                       str += "<td>순위</td>"
                       str += "<td>가게이름</td>"
                       str += "<td>평점</td>"
                       str += "</tr>"
                   for(var i=5;i<9;i++){
                     str += "<tr>"
                     str += "<td>"+i+"</td>"
                     str += "<td>"+data.ttname[i-1]+"</td>"
                     str += "<td><span class='text-warning'> ★ </span> "+data.ttstar[i-1]+"</td>"
                     str += "</tr>"
                  }
                   
                     $('#eatlist2').append(str)
               },
                error:function(request,status,error){
                   alert("fail");
                   alert("code:"+request.status+"\n"+"error:"+error);
                  }
            })
         })
      })
      $(document).ready(function(){
         $('#eatplace').on("change",function(){
            var gu = $('#eatplace option:selected').text()
            $.ajax({
               url:"/plan/planwrite",
               type:"POST",
               data : {'gu':gu, 'csrfmiddlewaretoken' : '{{csrf_token}}'},
               dataType: "json",
               success : function(data){
                  $("#eatlist3 *").remove();
                      var str = ""   
                      str += "<tr>"
                       str += "<td>순위</td>"
                       str += "<td>가게이름</td>"
                       str += "<td>평점</td>"
                       str += "</tr>"
                   for(var i=9;i<13;i++){
                     str += "<tr>"
                     str += "<td>"+i+"</td>"
                     str += "<td>"+data.ttname[i-1]+"</td>"
                     str += "<td><span class='text-warning'> ★ </span> "+data.ttstar[i-1]+"</td>"
                     str += "</tr>"
                  }
                   
                     $('#eatlist3').append(str)
               },
                error:function(request,status,error){
                   alert("fail");
                   alert("code:"+request.status+"\n"+"error:"+error);
                  }
            })
         })
      })

</script>

   <style>
details { margin:5px 0 10px;}
details > summary { padding:10px; outline:0;  cursor:pointer; transition:background 0.5s; text-align:left; box-shadow: 1px 1px 2px gray;  position:absolute; top:350px; z-index:9999; left:50%; transform:translateX(-50%);}
details > summary::-webkit-details-marker { background:#1a374d; color:#fff; background-size:contain; transform:rotate3d(0, 0, 1, 90deg); transition:transform 0.25s;}
details[open] > summary::-webkit-details-marker { transform:rotate3d(0, 0, 1, 180deg);}
details[open] > summary { background:#1a374d;}
details[open] > summary ~ * { animation:reveal 0.5s;}
.tpt { background:#1a374d; color:#fff; margin:5px 0 10px; padding:5px 10px; line-height:25px; border-radius:5px; box-shadow: 1px 1px 2px gray;}
@keyframes reveal {
    from { opacity:0; transform:translate3d(0, -30px, 0); }
    to { opacity:1; transform:translate3d(0, 0, 0); }
}
  	

	.map_wrap, .map_wrap * {margin:0; padding:0;font-family:'Malgun Gothic',dotum,'돋움',sans-serif;font-size:12px;}
	.map_wrap {position:relative;width:100%;height:350px;}
	#category {position:absolute;top:10px;left:10px;border-radius: 5px; overflow: hidden;z-index: 2;}
	#category li {float:left;list-style: none;width:50px;height:50px;padding-top:20px;border-right:1px solid #acacac;padding:6px 0;text-align: center; cursor: pointer; border-radius:50%;background-color:#d95050; color:white;margin-right:5px;font-size:0.9em;padding-top:16px;}
	#category li.on {background: #fff; color:black;}
	#category li:hover {background: #ffe6e6; color:black;}
	#category li:last-child{margin-right:0;border-right:0;}
	#category li span {display: block;margin:0 auto 3px;width:27px;height: 28px;}
	#category li .category_bg {background:url(https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/places_category.png) no-repeat;}
	#category li .bank {background-position: -10px 0;}
	#category li .mart {background-position: -10px -36px;}
	#category li .pharmacy {background-position: -10px -72px;}
	#category li .oil {background-position: -10px -108px;}
	#category li .cafe {background-position: -10px -144px;}
	#category li .store {background-position: -10px -180px;}
	#category li.on .category_bg {background-position-x:-46px;}
	.placeinfo_wrap {position:absolute;bottom:28px;left:-150px;width:200px;}
	.placeinfo {position:relative;width:100%;border-radius:6px;border: 1px solid #ccc;border-bottom:2px solid #ddd;padding-bottom: 10px;background: #fff;}
	.placeinfo:nth-of-type(n) {border:0; box-shadow:0px 1px 2px #888;}
	.placeinfo_wrap .after {content:'';position:relative;margin-left:-12px;left:50%;width:22px;height:12px;background:url('https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/vertex_white.png')}
	.placeinfo a, .placeinfo a:hover, .placeinfo a:active{color:#fff;text-decoration: none;}
	.placeinfo a, .placeinfo span {display: block;text-overflow: ellipsis;overflow: hidden;white-space: nowrap;}
	.placeinfo span {margin:5px 5px 0 5px;cursor: default;font-size:13px;}
	.placeinfo .title {font-weight: bold; font-size:14px;border-radius: 6px 6px 0 0;margin: -1px -1px 0 -1px;padding:10px; color: #fff;background: #d95050;background: #d95050 url(https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/arrow_white.png) no-repeat right 14px center;}
	.placeinfo .tel {color:#0f7833;}
	.placeinfo .jibun {color:#999;font-size:11px;margin-top:0;}
	.placeinfo .close {position: absolute;top:5px;right:-30px;color:#000;width:26px;height:26px;opacity:1.0;border-radius:5px; background: url("{% static 'images/x_button.png' %}");}
    .placeinfo .close:hover {cursor: pointer;}
	
	
	
	#menu_wrap hr {display: block; height: 1px;border: 0; border-top: 2px solid #5F5F5F;margin:3px 0;}
	#menu_wrap .option{text-align: center;}
	#menu_wrap .option p {margin:10px 0;}  
	#menu_wrap .option button {margin-left:5px;}
	#placesList { padding: 0;}
	#placesList li {list-style: none;}
	#placesList .item {position:relative;border-bottom:1px solid #888;overflow: hidden;cursor: pointer;min-height: 65px;}
	#placesList .item span {display: block;margin-top:4px;}
	#placesList .item h5, #placesList .item .info {text-overflow: ellipsis;overflow: hidden;white-space: nowrap;}
	#placesList .item .info{padding:10px 0 10px 55px;}
	#placesList .info .gray {color:#8a8a8a;}
	#placesList .info .jibun {padding-left:26px;background:url(https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/places_jibun.png) no-repeat;}
	#placesList .info .tel {color:#009900;}
	#placesList .item .markerbg {float:left;position:absolute;width:36px; height:37px;margin:20px 0 0 0;background:url("{% static 'images/marker_number_red.png' %}") no-repeat;}
	#placesList .item .marker_1 {background-position: 0 -10px;}
	#placesList .item .marker_2 {background-position: 0 -56px;}
	#placesList .item .marker_3 {background-position: 0 -102px}
	#placesList .item .marker_4 {background-position: 0 -148px;}
	#placesList .item .marker_5 {background-position: 0 -194px;}
	#placesList .item .marker_6 {background-position: 0 -240px;}
	#placesList .item .marker_7 {background-position: 0 -286px;}
	#placesList .item .marker_8 {background-position: 0 -332px;}
	#placesList .item .marker_9 {background-position: 0 -378px;}
	#placesList .item .marker_10 {background-position: 0 -423px;}
	#placesList .item .marker_11 {background-position: 0 -470px;}
	#placesList .item .marker_12 {background-position: 0 -516px;}
	#placesList .item .marker_13 {background-position: 0 -562px;}
	#placesList .item .marker_14 {background-position: 0 -608px;}
	#placesList .item .marker_15 {background-position: 0 -654px;}
	.placeinfo2_wrap {position:absolute;bottom:28px;left:-150px;width:200px;}
	.placeinfo2 {position:relative;width:100%;border-radius:6px;border: 1px solid #ccc;border-bottom:2px solid #ddd;padding-bottom: 10px;background: #fff;}
	.placeinfo2:nth-of-type(n) {border:0; box-shadow:0px 1px 2px #888;}
	.placeinfo2_wrap .after {content:'';position:relative;margin-left:-12px;left:50%;width:22px;height:12px;background:url('https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/vertex_white.png')}
	.placeinfo2 a, .placeinfo2 a:hover, .placeinfo2 a:active{color:#fff;text-decoration: none;}
	.placeinfo2 a, .placeinfo2 span {display: block;text-overflow: ellipsis;overflow: hidden;white-space: nowrap;}
	.placeinfo2 span {margin:5px 5px 0 5px;cursor: default;font-size:13px;}
	.placeinfo2 .title {font-weight: bold; font-size:14px;border-radius: 6px 6px 0 0;margin: -1px -1px 0 -1px;padding:10px; color: #fff;background: #d95050;background: #d95050 url(https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/arrow_white.png) no-repeat right 14px center;}
	.placeinfo2 .tel {color:#0f7833;}
	.placeinfo2 .jibun {color:#999;font-size:11px;margin-top:0;}
	.placeinfo2 .close {position: absolute;top:5px;right:-30px;color:#000;width:26px;height:26px;opacity:1.0;border-radius:5px; background: url("{% static 'images/x_button.png' %}");}
    .placeinfo2 .close:hover {cursor: pointer;}
	#pagination2 {margin:10px auto;text-align: center;}
	#pagination2 a {display:inline-block;margin-right:10px;}
	#pagination2 .on {font-weight: bold; cursor: default;color:#777;}
	.hide{display:none;}
	.hide1, .hide2, .hide3, .hide4, .hide5 {display:none;}
	
	</style>
	
	<div class="px-3 mt-3">
		<h2>일정만들기</h2>
		<hr/>
		<div class="row mb-3">
			<div id="mapbox" class="col-md-8" style="z-index:1">
				<div class="map_wrap" style="height:800px;">
				    <div id="map" style="width:100%;height:800px;position:static;overflow:hidden;"></div>
				    <div id="map2" style="width:100%;height:800px;position:relative;overflow:hidden;"></div>
				    <ul id="category">
				        <li id="CT1" data-order="0"> 
				            <!-- <span class="category_bg bank"></span> -->
				            문화시설
				        </li>       
				        <li id="AT4" data-order="1"> 
				            <!-- <span class="category_bg mart"></span> -->
				            관광명소
				        </li>  
				        <li id="AD5" data-order="2"> 
				            <!-- <span class="category_bg pharmacy"></span> -->
				            숙박
				        </li>  
				        <li id="FD6" data-order="3"> 
				            <!-- <span class="category_bg oil"></span> -->
				            식당
				        </li>  
				        <li id="CE7" data-order="4"> 
				            <!-- <span class="category_bg cafe"></span> -->
				            카페
				        </li>  
				        <!-- <li id="CS2" data-order="5"> 
				            <span class="category_bg store"></span>
				            편의점
				        </li>    -->   
				    </ul>
				</div>
				
				<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=0ff2691dce1f8209c92701ced2d4c724&libraries=services,clusterer,drawing"></script>
				<script>

				// 마커를 클릭했을 때 해당 장소의 상세정보를 보여줄 커스텀오버레이입니다
				var placeOverlay = new kakao.maps.CustomOverlay({zIndex:1}), 
				    contentNode = document.createElement('div'), // 커스텀 오버레이의 컨텐츠 엘리먼트 입니다 
				    markers = [], // 마커를 담을 배열입니다
				    currCategory = ''; // 현재 선택된 카테고리를 가지고 있을 변수입니다
				
				var lat = 37.566826;
				var lng = 126.9786567;
				    
				    
				var mapContainer = document.getElementById('map'), // 지도를 표시할 div 
				    mapOption = {
				        center: new kakao.maps.LatLng(37.566826, 126.9786567), // 지도의 중심좌표
				        level: 8 // 지도의 확대 레벨
				    };  
				
				// 지도를 생성합니다    
				var map = new kakao.maps.Map(mapContainer, mapOption); 
				
				// 장소 검색 객체를 생성합니다
				var ps = new kakao.maps.services.Places(map); 
				
				
				// 지도에 idle 이벤트를 등록합니다
				kakao.maps.event.addListener(map, 'idle', searchPlaces);
				
				// 커스텀 오버레이의 컨텐츠 노드에 css class를 추가합니다 
				contentNode.className = 'placeinfo_wrap';
				
				// 커스텀 오버레이의 컨텐츠 노드에 mousedown, touchstart 이벤트가 발생했을때
				// 지도 객체에 이벤트가 전달되지 않도록 이벤트 핸들러로 kakao.maps.event.preventMap 메소드를 등록합니다 
				addEventHandle(contentNode, 'mousedown', kakao.maps.event.preventMap);
				addEventHandle(contentNode, 'touchstart', kakao.maps.event.preventMap);
				
				
				//=========================================지도, 스카이뷰, 컨드롤 기능 추가========================================
	            // 일반 지도와 스카이뷰로 지도 타입을 전환할 수 있는 지도타입 컨트롤을 생성합니다
	            var mapTypeControl = new kakao.maps.MapTypeControl();
	            
	            // 지도에 컨트롤을 추가해야 지도위에 표시됩니다
	            // kakao.maps.ControlPosition은 컨트롤이 표시될 위치를 정의하는데 TOPRIGHT는 오른쪽 위를 의미합니다
	            map.addControl(mapTypeControl, kakao.maps.ControlPosition.TOPRIGHT);
	            
	            // 지도 확대 축소를 제어할 수 있는  줌 컨트롤을 생성합니다
	            var zoomControl = new kakao.maps.ZoomControl();
	            map.addControl(zoomControl, kakao.maps.ControlPosition.RIGHT);
				//=========================================지도, 스카이뷰, 컨드롤 기능 추가========================================
				
				
				// 커스텀 오버레이 컨텐츠를 설정합니다
				placeOverlay.setContent(contentNode); 
				
				// 각 카테고리에 클릭 이벤트를 등록합니다
				addCategoryClickEvent();
				
				// 엘리먼트에 이벤트 핸들러를 등록하는 함수입니다
				function addEventHandle(target, type, callback) {
				    if (target.addEventListener) {
				        target.addEventListener(type, callback);
				    } else {
				        target.attachEvent('on' + type, callback);
				    }
				}
				
				// 카테고리 검색을 요청하는 함수입니다
				function searchPlaces() {
				    if (!currCategory) {
				        return;
				    }
				    
				    // 커스텀 오버레이를 숨깁니다 
				    placeOverlay.setMap(null);
				    searchOverlay.setMap(null);
				    // 지도에 표시되고 있는 마커를 제거합니다
				    removeMarker();
				    removeMarker2();
				    
				    ps.categorySearch(currCategory, placesSearchCB, {
				    	useMapBounds: true,
				    	 size:15,
		                 location: new kakao.maps.LatLng(37.54866166089373, 126.99069799329651),
		                 radius:15000,
				    }); 
				}
				
				// 장소검색이 완료됐을 때 호출되는 콜백함수 입니다
				function placesSearchCB(data, status, pagination) {
				    if (status === kakao.maps.services.Status.OK) {
				
				        // 정상적으로 검색이 완료됐으면 지도에 마커를 표출합니다
				        displayPlaces(data);
					    searchOverlay.setMap(null);
					    removeMarker2();
				        
				    } else if (status === kakao.maps.services.Status.ZERO_RESULT) {
				        // 검색결과가 없는경우 해야할 처리가 있다면 이곳에 작성해 주세요
				
				    } else if (status === kakao.maps.services.Status.ERROR) {
				        // 에러로 인해 검색결과가 나오지 않은 경우 해야할 처리가 있다면 이곳에 작성해 주세요
				        
				    }
				}
				
				// 지도에 마커를 표출하는 함수입니다
				function displayPlaces(places) {
				
				    // 몇번째 카테고리가 선택되어 있는지 얻어옵니다
				    // 이 순서는 스프라이트 이미지에서의 위치를 계산하는데 사용됩니다
				    var order = document.getElementById(currCategory).getAttribute('data-order');
				    


				    for ( var i=0; i<places.length; i++ ) {
				
				            // 마커를 생성하고 지도에 표시합니다
				            var marker = addMarker(new kakao.maps.LatLng(places[i].y, places[i].x), order);
				
				            // 마커와 검색결과 항목을 클릭 했을 때
				            // 장소정보를 표출하도록 클릭 이벤트를 등록합니다
				            (function(marker, place) {
				                kakao.maps.event.addListener(marker, 'mouseover', function() {
				                    displayPlaceInfo(place);
				                });
				            })(marker, places[i]);
				    }
				}
				
				// 마커를 생성하고 지도 위에 마커를 표시하는 함수입니다
				function addMarker(position, order) {
	                var imageSrc = '{% static "images/cate_icon.png" %}', // 마커 이미지 url, 스프라이트 이미지를 씁니다
	                    imageSize = new kakao.maps.Size(27, 26),  // 마커 이미지의 크기
	                    imgOptions =  {
	                        spriteSize : new kakao.maps.Size(27, 127), // 스프라이트 이미지의 크기
	                        spriteOrigin : new kakao.maps.Point(0, (order*25)), // 스프라이트 이미지 중 사용할 영역의 좌상단 좌표
	                        offset: new kakao.maps.Point(11, 28) // 마커 좌표에 일치시킬 이미지 내에서의 좌표
	                    },
	                    markerImage = new kakao.maps.MarkerImage(imageSrc, imageSize, imgOptions),
	                        marker = new kakao.maps.Marker({
	                        position: position, // 마커의 위치
	                        image: markerImage 
	                    });
	            
	                marker.setMap(map); // 지도 위에 마커를 표출합니다
	                markers.push(marker);  // 배열에 생성된 마커를 추가합니다
	            
	                return marker;
            	}
				
				// 지도 위에 표시되고 있는 마커를 모두 제거합니다
				function removeMarker() {
				    for ( var i = 0; i < markers.length; i++ ) {
				        markers[i].setMap(null);
				    }   
				    markers = [];
				}
				
				//지도에서 일정칸으로 추가
				/* var a = 1;
				function placeMove(placeName){
					//alert(placeName);
					alert(a);
					
					if($(".box").hasClass("plan"+a)){
						$(".plan"+a).find(".insertplace").val(placeName);
						a++;
					}else{
						a = a;
					}
			    } */
				
				
				
				// 클릭한 마커에 대한 장소 상세정보를 커스텀 오버레이로 표시하는 함수입니다
				function displayPlaceInfo (place) {
	                var content = '<div class="placeinfo">' +
	                                '   <a class="title text-center text-white" href="javascript:void(0)"><h3 name="'+place.address_name+'" id="'+place.place_url+'" class="' + place.place_name + '">' + place.place_name + '</h3></a>'+
	                                '            <a href="javascript:void(0)" class="close" onclick="closeOverlay()" title="닫기"></a>';   
	            
	                if (place.road_address_name) {
	                    content += '    <span title="' + place.road_address_name + '">' + place.road_address_name + '</span>' +
	                                '   <span class="jibun addr" title="' + place.address_name + '">(지번 : ' + place.address_name + ')</span>';
	                }  else {
	                    content += '    <span class="addr" title="' + place.address_name + '">' + place.address_name + '</span>';
	                }                
	               
	                content +=  '       <span class="tel">' + place.phone + '</span>' + 
	                            '      <span><a href="javascript:void(0)" id="test" class="insert py-1 btn-p1-open-add-schedule" style="width:100%;color:white;background-color:#d95050;text-align:center;margin-bottom:7px" role="button">일정추가</a>'+
	                            '      <a href="javascript:void(0)" class="insert py-1 btn-p1-product-detail" style="width:100%;color:white;background-color:#aaa;text-align:center;" role="button">상세보기</a></span>'+
	                         '</div>'+
	                            '<div class="after"></div>';
	            
	                contentNode.innerHTML = content;
	                placeOverlay.setPosition(new kakao.maps.LatLng(place.y, place.x));
	                placeOverlay.setMap(map);  
           	 	}
			    		    
			    var hClass_data = [];
				var coords_data = [];
				var markers3 = [];
				var linepaths = [];
				var linePath;
				var drawLines = [];
				var infowin = [];
			    var a = 1;
			    var mark_num = 1;
			    $(document).on("click touched",'.btn-p1-open-add-schedule',function(){
	         		var hClass = $('h3').attr('class');		//장소 이름 받아옴
	         		var hAddr = $('h3').attr('name');		//장소 지번 주소 받아옴
	         		var addr = $('.addr').attr('title');
	         		         		
	         		if($(".box").hasClass("plan"+a)){
		                $('.plan'+a).find('.insertplace').val(hClass);
		                $('.plan'+a).find('.addr').val(addr);
		                removeMarker3();
			         	removePath();
		                
		         		var test1 = [];
		         		var len = $(".box").length;
		         		for(var j=1; j<len+1; j++){
		         			$(".box:eq("+(j-1)+")").attr("title", j);
		         			var test = j;
		         				test1.push(test);
		         		}
		        		
		         		var b = $(".plan"+a).attr("title");
		                
				        var geocoder = new kakao.maps.services.Geocoder();
				            
					    // 주소로 좌표를 검색합니다
					    geocoder.addressSearch(hAddr, function(result,idx,status) {
									
				        	hClass_data.splice(b-1, 0, hClass);		//장소 이름 hClass_data 입력
		
							//마커 이미지(좌표, 크기, 옵션)
							//for(var j = 0; j<hClass_data.length; j++){
					        	
							//좌표 값 받아오기
							var coords = new kakao.maps.LatLng(result[0].y, result[0].x);
							
							coords_data.splice(b-1, 0, coords);		//장소 이름 coords_data 입력
					         
							var iwContent = hClass
							infowin.splice(b-1, 0, iwContent)
							console.log(infowin)
							
							for(var k=0;k<hClass_data.length;k++){
		
								var imageSrc3 = 'https://planner.jeju.com/images/map_icon/pin_SC_'+test1[k]+'.png',
								imageSize3 = new kakao.maps.Size(35, 40),
								imageOption3 = {
								 	spriteSize : new kakao.maps.Size(24, 38), // 스프라이트 이미지의 크기 
								 	offset : new kakao.maps.Point(13, 37)
								};
								
								var markerImage3 = new kakao.maps.MarkerImage(imageSrc3, imageSize3, imageOption3)
							
								// 결과값으로 받은 위치를 마커로 표시합니다
								var marker3 = new kakao.maps.Marker({
									map: map,
									position : coords_data[k],
									clickable : true,	//마커를 클릭했을 때 지도의 클릭 이벤트가 발생하지 않도록 설정
									image : markerImage3	//마커 이미지 받기
								});
								markers3.splice(b-1, 0, marker3);
			                 
				                 // 인포윈도우로 장소에 대한 설명을 표시합니다
				                var infowindow = new kakao.maps.InfoWindow({
				                	content: '<div>'+infowin[k]+'</div>',
				                });
				                kakao.maps.event.addListener(marker3, 'mouseover', makeOverListener(map, marker3, infowindow));
				                kakao.maps.event.addListener(marker3, 'mouseout', makeOutListener(infowindow));
					                 
							}
							
							function makeOverListener(map, marker3, infowindow) {
							    return function() {
							        infowindow.open(map, marker3);
							    };
							}

							// 인포윈도우를 닫는 클로저를 만드는 함수입니다 
							function makeOutListener(infowindow) {
							    return function() {
							        infowindow.close();
							    };
							}
							
									
							for(var i=0;i<markers3.length;i++){
								if(i != 0){
									linePath = [coords_data[i-1], coords_data[i]]
									linepaths.splice(i-1, 1, linePath);
								};
							}
// 							console.log(linepaths);
							linepaths.splice(b-1, 0, linePath);
// 							console.log(linepaths);
							
							for(var i=0; i<markers3.length; i++){							
								var drawLine = new kakao.maps.Polyline({
									map : map,
									path : linepaths[i-1],	// 1번 위치와 2번 위치가 같이 들어가야함
									strokeWeight : 7,
									strokeColor : 'red',
									strokeStyle : 'solid',
									strokeOpacity : 0.6,
								});
								drawLines.push(drawLine);
								drawLine.setMap(map);
							}
							a++;
						});

					}else{
						alert("일정 추가를 눌러주세요")
						a = a;
					}
				});
			    
				function removeMarker3() {
 				    for ( var y = 0; y < markers3.length; y++ ) {
 				        markers3[y].setMap(null);
 				    }   
 				    markers3 = [];
 				}	
 				function removePath() {
 				    for ( var y = 0; y < drawLines.length; y++ ) {
 				    	drawLines[y].setMap(null);
 				    	delete linepaths[y];
 				    }   
 				  drawLines = [];
 				  linepaths = [];
 				}	
 				
             	$(document).on("click touched",'.btn-p1-product-detail',function(){
                	/* var hClass = $('h3').attr('class');
                	$('.insertplace').val(hClass); */
                	var url =  $('h3').attr('id');
                	window.open(url, '다음지도팝업', 'width=925px,height=800px,scrollbars=yes');   
             	})
             	
				
				// 각 카테고리에 클릭 이벤트를 등록합니다
				function addCategoryClickEvent() {
				    var category = document.getElementById('category'),
				        children = category.children;
				
				    for (var i=0; i<children.length; i++) {
				        children[i].onclick = onClickCategory;
				    }
				}
				
				// 카테고리를 클릭했을 때 호출되는 함수입니다
				function onClickCategory() {
				    var id = this.id,
				        className = this.className;
				
				    placeOverlay.setMap(null);
				
				    if (className === 'on') {
				        currCategory = '';
				        changeCategoryClass();
				        removeMarker();
				        searchPlaces2();
				    } else {
				        currCategory = id;
				        changeCategoryClass(this);
				        searchPlaces();
				    }
				}
				
				// 클릭된 카테고리에만 클릭된 스타일을 적용하는 함수입니다
				function changeCategoryClass(el) {
				    var category = document.getElementById('category'),
				        children = category.children,
				        i;
				
				    for ( i=0; i<children.length; i++ ) {
				        children[i].className = '';
				    }
				
				    if (el) {
				        el.className = 'on';
				    } 
				} 
				
 				/* //마커 연결하기
			    
				const lookCourseBtn = document.getElementById('lookCourseBtn');
 						lookCourseBtn.addEventListener('click', event =>{
 							
 					for (var i = 0; i<overlays.length; i++){
 						overlays[i].setMap(null);
	 					}		
	 					overlays = [];
	 					addLine(markers);
	 					
 					for (var j = 0; j<positions.length; j++){
 						var content = '<div class="customoverlay">' + 
 									'		<a>'+
 									'		<span id="numbers">'+(j+1)+'</span><span class="title">'+names[j]+'</span>'
 									'		</a>' + 
 									'</div>;'
 									addText(positions[j], content);
 						}
 				});
			    
				function addLine(markers){
					var linePath = [];
					for (i=0; i<markers.length; ++i){
						linePath.push(markers[i].getPosition());
					}
					
					//지도에 표시할 선 생성
					var polyline = new kakao.maps.Polyline({
						path: linePath,
						strokeWeight : 2,
						strokeColor : 'blue',
						strokeOpacity : 0.7,
						strokeStyle : 'solid',
					});
					lines.push(polyline);
					//지도에 선 표시
					polyline.setMap(map);
					
				}
 						
 				function addText(pos, con){		// 줘야항 매개변수는 좌표(포지션), 콘탠츠(들어갈 값)
 					var customOverlay = new kakao.maps.CustomOverlay({
 						map : map,
 						position : pos,
 						content : con,
 						yAnchor : 1
 					});
 				ovarlays.push(customOverlay)
 				};		 */
				
 				
 				/* =======================================장소검색 관련 스크립트 ================================================ */
 				var searchOverlay = new kakao.maps.CustomOverlay({zIndex:1}),
 				contentNode2 = document.createElement('div'), // 커스텀 오버레이의 컨텐츠 엘리먼트 입니다 
 				markers2 = [];
 				
 				var infowindow = new kakao.maps.InfoWindow({zIndex:1});
 				
 				// 장소 검색 객체를 생성합니다
 				var ps2 = new kakao.maps.services.Places();  
 				
 				// 검색 결과 목록이나 마커를 클릭했을 때 장소명을 표출할 인포윈도우를 생성합니다
 				contentNode2.className = 'placeinfo2_wrap';
 				/* addEventHandle(contentNode2, 'mousedown', kakao.maps.event.preventMap);
 				addEventHandle(contentNode2, 'touchstart', kakao.maps.event.preventMap); */
 				searchOverlay.setContent(contentNode2);
 			
 			
 				
 				// 키워드로 장소를 검색합니다
 				searchPlaces2();
 				
 				// 키워드 검색을 요청하는 함수입니다
 				function searchPlaces2() {
 				    var keyword = document.getElementById('keyword').value;
 				    if (!keyword.replace(/^\s+|\s+$/g, '')) {
 				        return false;
 				    }
 				    // 커스텀 오버레이를 숨깁니다 
 				    placeOverlay.setMap(null);
 				    searchOverlay.setMap(null);
 				    // 지도에 표시되고 있는 카테고리마커를 제거합니다
 				    removeMarker();
 				    removeMarker2();
 				    // 장소검색 객체를 통해 키워드로 장소검색을 요청합니다
 				    ps2.keywordSearch( keyword, placesSearchCB2,{
 				    	useMapBounds: true,
				    	 size:15,
		                 radius:15000,
		                 location: new kakao.maps.LatLng(37.54866166089373, 126.99069799329651)
 				    
 				    }); 
 				    
 				}
 				
 				// 장소검색이 완료됐을 때 호출되는 콜백함수 입니다
 				function placesSearchCB2(data, status, pagination) {
 				    if (status === kakao.maps.services.Status.OK) {
 				        // 정상적으로 검색이 완료됐으면
 				        // 검색 목록과 마커를 표출합니다
 				        displayPlaces2(data);
 				        // 페이지 번호를 표출합니다
 				        displayPagination(pagination);
 				
 				    } else if (status === kakao.maps.services.Status.ZERO_RESULT) {
 				        alert('검색 결과가 존재하지 않습니다.');
 				        return;
 				    } else if (status === kakao.maps.services.Status.ERROR) {
 				        alert('검색 결과 중 오류가 발생했습니다.');
 				        return;
 				
 				    }
 				}
 				
 				// 검색 결과 목록과 마커를 표출하는 함수입니다
 				function displayPlaces2(places) {
 				
 				    var listEl = document.getElementById('placesList'), 
 				    menuEl = document.getElementById('menu_wrap'),
 				    fragment = document.createDocumentFragment(), 
 				    bounds = new kakao.maps.LatLngBounds(), 
 				    listStr = '';
 				    
 				    // 검색 결과 목록에 추가된 항목들을 제거합니다
 				    removeAllChildNods(listEl);
 				
 				    // 지도에 표시되고 있는 마커를 제거합니다		    
 				    removeMarker2();
 				    
 				    for ( var i=0; i<places.length; i++ ) {
 				
 				        // 마커를 생성하고 지도에 표시합니다
 				        var placePosition2 = new kakao.maps.LatLng(places[i].y, places[i].x),
 				            marker2 = addMarker2(placePosition2, i), 
 				            itemEl = getListItem(i, places[i]); // 검색 결과 항목 Element를 생성합니다

 				        // 검색된 장소 위치를 기준으로 지도 범위를 재설정하기위해
 				        // LatLngBounds 객체에 좌표를 추가합니다
 				        bounds.extend(placePosition2);
 				
 				        // 마커와 검색결과 항목에 mouseover 했을때
 				        // 해당 장소에 인포윈도우에 장소명을 표시합니다
 				        // mouseout 했을 때는 인포윈도우를 닫습니다
 				        (function(marker2, place) {
 				            kakao.maps.event.addListener(marker2, 'click', function() {
 				            	displayPlaceInfo2(place);
 				            	var addr = $('.addr').attr('title');
 				            	$('.plan'+a).find('.addr').val(addr);
 				            	placeOverlay.setMap(null);
 				            });
 				
 				            itemEl.onclick =  function () {
 				            	displayPlaceInfo2(place);
 				            	var addr = $('.addr').attr('title');
 				            	$('.plan'+a).find('.addr').val(addr);
 				            	placeOverlay.setMap(null);
 				            };

 				        })(marker2, places[i]);
 				
 				        fragment.appendChild(itemEl);
 				    }
 				
 				    // 검색결과 항목들을 검색결과 목록 Element에 추가합니다
 					listEl.appendChild(fragment);
 					menuEl.scrollTop = 0;
 				
 				    // 검색된 장소 위치를 기준으로 지도 범위를 재설정합니다  
 				    map.setBounds(bounds);
 				}
 				
 				// 검색결과 항목을 Element로 반환하는 함수입니다
 				function getListItem(index, places) {
 				
 				    var el2 = document.createElement('li'),
 				    itemStr = '<span class="markerbg marker_' + (index+1) + '"></span>' +
 				                '<div class="info">' +
 				                '   <h5>' + places.place_name + '</h5>';
 				    if (places.road_address_name) {
 				        itemStr += '    <span>' + places.road_address_name + '</span>' +
 				                    '   <span class="jibun gray">' +  places.address_name  + '</span>';
 				    } else {
 				        itemStr += '    <span>' +  places.address_name  + '</span>'; 
 				    }
 				                 
 				      itemStr += '  <span class="tel">' + places.phone  + '</span>' +
 				                '</div>';           
 				
 				    el2.innerHTML = itemStr;
 				    el2.className = 'item';
 				
 				    return el2;
 				}
 				
 				// 마커를 생성하고 지도 위에 마커를 표시하는 함수입니다
 				function addMarker2(position, idx, title) {
 				    var imageSrc2 = '{% static "images/marker_number_red.png" %}', // 마커 이미지 url, 스프라이트 이미지를 씁니다
 				        imageSize2 = new kakao.maps.Size(36, 37),  // 마커 이미지의 크기
 				        imgOptions2 =  {
 				            spriteSize : new kakao.maps.Size(36, 691), // 스프라이트 이미지의 크기
 				            spriteOrigin : new kakao.maps.Point(0, (idx*46)+10), // 스프라이트 이미지 중 사용할 영역의 좌상단 좌표
 				            offset: new kakao.maps.Point(13, 37) // 마커 좌표에 일치시킬 이미지 내에서의 좌표
 				        },
 				        markerImage2 = new kakao.maps.MarkerImage(imageSrc2, imageSize2, imgOptions2),
 				            marker2 = new kakao.maps.Marker({
 				            position: position, // 마커의 위치
 				            image: markerImage2
 				        });
 				       		
 				    marker2.setMap(map); // 지도 위에 마커를 표출합니다
 				    markers2.push(marker2);  // 배열에 생성된 마커를 추가합니다
 				
 				    return marker2;
 				}
 				
 				// 지도 위에 표시되고 있는 마커를 모두 제거합니다
 				function removeMarker2() {
 				    for ( var i = 0; i < markers2.length; i++ ) {
 				        markers2[i].setMap(null);
 				    }   
 				    markers2 = [];
 				}
 				
 				// 검색결과 목록 하단에 페이지번호를 표시는 함수입니다
 				function displayPagination(pagination) {
 				    var paginationEl = document.getElementById('pagination2'),
 				        fragment = document.createDocumentFragment(),
 				        i; 
 				
 				    // 기존에 추가된 페이지번호를 삭제합니다
 				    while (paginationEl.hasChildNodes()) {
 				        paginationEl.removeChild (paginationEl.lastChild);
 				    }
 				
 				    for (i=1; i<=pagination.last; i++) {
 				        var el2 = document.createElement('a');
 				        el2.href = "javascript:void(0)";
 				        el2.innerHTML = i;
 				
 				        if (i===pagination.current) {
 				            el2.className = 'on';
 				        } else {
 				            el2.onclick = (function(i) {
 				                return function() {
 				                    pagination.gotoPage(i);
 				                }
 				            })(i);
 				        }
 				
 				        fragment.appendChild(el2);
 				    }
 				    paginationEl.appendChild(fragment);
 				}
 				
 				// 검색결과 목록 또는 마커를 클릭했을 때 호출되는 함수입니다
 				// 인포윈도우에 장소명을 표시합니다
 				function displayPlaceInfo2(place) {
 					var content = '<div class="placeinfo2">' +
 					                '   <a class="title text-center text-white" href="javascript:void(0)"><h3 name="'+place.address_name+'" id="'+place.place_url+'" class="' + place.place_name + '">' + place.place_name + '</h3></a>'+   
 					                '            <a href="javascript:void(0)" class="close" onclick="closeOverlay()" title="닫기"></a>'; 
 					if (place.road_address_name) {
 					    content += '    <span title="' + place.road_address_name + '">' + place.road_address_name + '</span>' +
 					                '   <span class="jibun addr" title="' + place.address_name + '">(지번 : ' + place.address_name + ')</span>';
 					}  else {
 					    content += '    <span class="addr" title="' + place.address_name + '">' + place.address_name + '</span>';
 					}                
 					
 					content +=  '       <span class="tel">' + place.phone + '</span>' + 
 					            '      <span><a href="javascript:void(0)" id="test" class="insert py-1 btn-p1-open-add-schedule" style="width:100%;color:white;background-color:#d95050;text-align:center;margin-bottom:7px" role="button">일정추가</a>'+
 					            '      <a href="javascript:void(0)" class="insert py-1 btn-p1-product-detail" style="width:100%;color:white;background-color:#aaa;text-align:center;" role="button">상세보기</a></span>'+
 					         '</div>'+
 					            '<div class="after"></div>';
 				    
 					contentNode2.innerHTML = content;
 					searchOverlay.setPosition(new kakao.maps.LatLng(place.y, place.x));
 					searchOverlay.setMap(map);
 				}
 				
 				 // 검색결과 목록의 자식 Element를 제거하는 함수입니다
 				function removeAllChildNods(el2) {   
 				    while (el2.hasChildNodes()) {
 				        el2.removeChild (el2.lastChild);
 				    }
 				}
 				
 				function closeOverlay() {
 				    searchOverlay.setMap(null);
 				    placeOverlay.setMap(null);
 				}
				</script>
			</div>
			
			
         	
         	
			<!-- 플래너 -->
			<div id="planner" class="col-md-4 border pt-2 bg-light" style="position:relative;z-index:3;">
			
				<!-- 장소검색창 시작 -->
				<button id="searchBtn" style="position:absolute;height:100px;left:-25px;top:50%;transform:translateY(-50%);z-index:999999;background-color:#1a374d;color:white;border:none;font-weight:bold;">장<br>소<br>검<br>색</button>
				<!-- <button id="searchBtn2" style="display:none;position:absolute;height:120px;left:-25px;top:50%;transform:translateY(-50%);z-index:999999;background-color:#1a374d;color:white;border:none;font-weight:bold;">장<br>소<br>검<br>색<br>&gt;</button> -->
				<div id="searchplace" class="px-2 py-2" style="width:350px;height:800px;position:absolute;top:0;left:-350px;background-color:rgba(255,255,255,0.9);z-index:2;display:none;">
	               	<div id="menu_wrap" class="bg_white" style="overflow-y:auto;overflow-x:hidden;" >
	                	<div class="option">
	                       	<form onsubmit="searchPlaces2(); return false;">
	                       		<div class="row">
	                       			<div class="col-8">
	                       				<input type="text" id="keyword" value="" class="form-control" placeholder="검색">
	                       			</div>
	                       			<div class="col-4">
	                       				<button type="submit" class="btn btn-sm btn-primary px-3 py-2">검색</button>
	                       			</div>
	                       		</div>
	                       	</form>
	                   	</div>
	                   	<hr>
	                   	<ul id="placesList" style="height:680px;overflow-y:auto;"></ul>
	                  	<div id="pagination2"></div>
	            	</div>
	         	</div>
	         	<!-- 장소검색창 끝 -->
	         	
				<!-- <div class="row mb-2">
					<div class="col">
						<button type="button" id="myPlan" class="btn btn-block btn-primary py-2">내일정</button>
					</div>
					<div class="col">
						<button type="button" id="searchPlace" class="btn btn-block py-2">장소검색</button>
					</div>
				</div> -->
				
				<!-- 플래너 시작 -->
				<div id="myplan">
					<form method="post" action="planWriteView" name="planWriteView">
					<input type="hidden" name="id" value="{{memid}}">
					<input type="hidden" name="nickname" value="{{nickname}}">
					{% csrf_token %}
					<div id="date" class="text-center">
						<input class="form-control mb-2" type="text" name="title" placeholder="제목을 입력해주세요">
						<div class="row mb-2">
							<div class="col">
								<span class="float-left">출발일자</span>
								<input class="form-control" type="date" name="sdate" placeholder="시작일">
							</div>
							<div class="col">
								<span class="float-left">여행일수</span>
								<select id="planDays" class="form-control" name="days">
									<option>선택하세요</option>
									<option value="1">1일</option>
									<option value="2">2일</option>
									<option value="3">3일</option>
									<option value="4">4일</option>
									<option value="5">5일</option>
									<option value="6">6일</option>
									<option value="7">7일</option>
								</select>
								<!-- <input id="planSelect" class="px-1" type="button" value="일정선택"> -->
							</div>
						</div>
					</div>
					<div style="height:650px;overflow-y:auto;overflow-x:hidden;" id="plan" class="bg-white border my-2 px-3 pt-2">
						<div class="row day1 hide">
							<div class="col text-center">
								<h3>Day1</h3>
								<!-- <button class="confirmPlan btn btn-outline-warning px-3 py-2" value="1">일정확정</button> -->
								<div class="planBox mt-3"></div>
								<button type="button" class="insertPlan btn btn-outline-secondary px-3 py-1" value="1">일정추가</button>
							</div>
						</div>
						<div class="row day2 hide">
							<div class="col text-center">
								<hr/>
								<h3>Day2</h3>
								<!-- <button class="confirmPlan btn btn-outline-warning px-3 py-2" value="2">일정확정</button> -->
								<div class="planBox mt-3"></div>
								<button type="button" class="insertPlan btn btn-outline-secondary px-3 py-1" value="2">일정추가</button>
							</div>
						</div>
						<div class="row day3 hide">
							<div class="col text-center">
								<hr/>
								<h3>Day3</h3>
								<!-- <button class="confirmPlan btn btn-outline-warning px-3 py-2" value="3">일정확정</button> -->
								<div class="planBox mt-3"></div>
								<button type="button" class="insertPlan btn btn-outline-secondary px-3 py-1" value="3">일정추가</button>
							</div>
						</div>
						<div class="row day4 hide">
							<div class="col text-center">
								<hr/>
								<h3>Day4</h3>
								<!-- <button class="confirmPlan btn btn-outline-warning px-3 py-2" value="4">일정확정</button> -->
								<div class="planBox mt-3"></div>
								<button type="button" class="insertPlan btn btn-outline-secondary px-3 py-1" value="4">일정추가</button>
							</div>
						</div>
						<div class="row day5 hide">
							<div class="col text-center">
								<hr/>
								<h3>Day5</h3>
								<!-- <button class="confirmPlan btn btn-outline-warning px-3 py-2" value="5">일정확정</button> -->
								<div class="planBox mt-3"></div>
								<button type="button" class="insertPlan btn btn-outline-secondary px-3 py-1" value="5">일정추가</button>
							</div>
						</div>
						<div class="row day6 hide">
							<div class="col text-center">
								<hr/>
								<h3>Day6</h3>
								<!-- <button class="confirmPlan btn btn-outline-warning px-3 py-2" value="5">일정확정</button> -->
								<div class="planBox mt-3"></div>
								<button type="button" class="insertPlan btn btn-outline-secondary px-3 py-1" value="6">일정추가</button>
							</div>
						</div>
						<div class="row day7 hide">
							<div class="col text-center">
								<hr/>
								<h3>Day7</h3>
								<!-- <button class="confirmPlan btn btn-outline-warning px-3 py-2" value="5">일정확정</button> -->
								<div class="planBox mt-3"></div>
								<button type="button" class="insertPlan btn btn-outline-secondary px-3 py-1" value="7">일정추가</button>
							</div>
						</div>
					</div>
					
					</form>
				</div>
				
			</div>
	</div>
	<div class="text-right mb-4">
		<input class="btn btn-primary mr-1" type="button" onclick="formchk()" value="저장">
		<input class="btn btn-danger mr-1" type="reset" id="reset" value="초기화">
		<input class="btn btn-secondary" type="button" value="나가기" onclick="location=href='/main'">
	</div>
	
	
	<script>

		
		</script>
	
	
	
	
	
	
	
	<script>
 	$("#searchBtn").click(function(){
 		//$("#searchplace").animate({left:-350});
 		$("#searchplace").toggle();
 		//$(this).css("display", "none");
 		//$("#searchBtn2").css("display", "");
	});
 	$("#searchBtn2").click(function(){
 		//$("#searchplace").animate({left:0});
 		//$("#searchplace").hide();
 		/* $(this).css("display", "none");
 		$("#searchBtn").css("display", ""); */
	});
	
	//일정확정버튼 클릭시
	/* $(".confirmPlan").click(function(){
		var insertPlan = $(".insertPlan").val();
		var confirmPlan = $(".confirmPlan").val();
		if(insertPlan == confirmPlan){
			$(this).siblings(".planBox").
			
			$(".plan"+i).find(".place").attr("readonly", true);
			$(".plan"+i).find(".time").attr("disabled", true);
			$(".plan"+i).find(".memo").attr("readonly", true);
		}
	}); */
	
	//초기화버튼
	$("#reset").click(function(){
		var conf = confirm("초기화하면 현재 정보가 삭제됩니다.\n초기화 하시겠습니까?");
		if(conf){
			location.reload();
		}else{
			return false;
		}
	});
	
	//일정선택 버튼클릭시
	$("#planDays").on("change", function(){
		var sdate = $("input[name='sdate']").val();
		var day = $("#planDays option:selected").val();
		//$("#plan").children().addClass("hide");
		if(day == 1){
			$("#plan").children(".day1").removeClass("hide");
			$("#plan").children(".day2").addClass("hide");
			$("#plan").children(".day3").addClass("hide");
			$("#plan").children(".day4").addClass("hide");
			$("#plan").children(".day5").addClass("hide");	
			$("#plan").children(".day6").addClass("hide");
			$("#plan").children(".day7").addClass("hide");
		}else if(day == 2){
			$("#plan").children(".day1").removeClass("hide");
			$("#plan").children(".day2").removeClass("hide");
			$("#plan").children(".day3").addClass("hide");
			$("#plan").children(".day4").addClass("hide");
			$("#plan").children(".day5").addClass("hide");
			$("#plan").children(".day6").addClass("hide");
			$("#plan").children(".day7").addClass("hide");
		}else if(day == 3){
			$("#plan").children(".day1").removeClass("hide");
			$("#plan").children(".day2").removeClass("hide");
			$("#plan").children(".day3").removeClass("hide");
			$("#plan").children(".day4").addClass("hide");
			$("#plan").children(".day5").addClass("hide");
			$("#plan").children(".day6").addClass("hide");
			$("#plan").children(".day7").addClass("hide");
		}else if(day == 4){
			$("#plan").children(".day1").removeClass("hide");
			$("#plan").children(".day2").removeClass("hide");
			$("#plan").children(".day3").removeClass("hide");
			$("#plan").children(".day4").removeClass("hide");
			$("#plan").children(".day5").addClass("hide");
			$("#plan").children(".day6").addClass("hide");
			$("#plan").children(".day7").addClass("hide");
		}else if(day == 5){
			$("#plan").children(".day1").removeClass("hide");
			$("#plan").children(".day2").removeClass("hide");
			$("#plan").children(".day3").removeClass("hide");
			$("#plan").children(".day4").removeClass("hide");
			$("#plan").children(".day5").removeClass("hide");
			$("#plan").children(".day6").addClass("hide");
			$("#plan").children(".day7").addClass("hide");
		}else if(day == 6){
			$("#plan").children(".day1").removeClass("hide");
			$("#plan").children(".day2").removeClass("hide");
			$("#plan").children(".day3").removeClass("hide");
			$("#plan").children(".day4").removeClass("hide");
			$("#plan").children(".day5").removeClass("hide");
			$("#plan").children(".day6").removeClass("hide");
			$("#plan").children(".day7").addClass("hide");
		}else if(day == 7){
			$("#plan").children(".day1").removeClass("hide");
			$("#plan").children(".day2").removeClass("hide");
			$("#plan").children(".day3").removeClass("hide");
			$("#plan").children(".day4").removeClass("hide");
			$("#plan").children(".day5").removeClass("hide");
			$("#plan").children(".day6").removeClass("hide");
			$("#plan").children(".day7").removeClass("hide");
		}
		
	});
	
	
	
	$("#myPlan").click(function(){
		$("#myPlan").addClass("btn-primary");
		$("#searchPlace").removeClass("btn-primary");
		$("#searchplace").hide();
		$("#myplan").show();
	});
	$("#searchPlace").click(function(){
		$("#searchPlace").addClass("btn-primary");
		$("#myPlan").removeClass("btn-primary");
		$("#myplan").hide();
		$("#searchplace").show();
	});
	
	//일정생성버튼 클릭시
	var i = 1;
	$(".insertPlan").click(function(){
		/* if($(this).siblings(".planBox").children(".plan"+i).children(".pp").children(".place").val() == ""){
			alert("장소를 선택 후 일정을 추가해 주세요");
			return false;
		} */
		
		//몇일날 일정인지 체크
		var day = $(this).val();
		
		//일정추가버튼 클릭시 작동
		$(this).siblings(".planBox").append(
				'<div style="border:2px solid #aaa; border-radius:5px;" class="px-1 py-1 mx-1 my-1 mb-2 radius box plan'+i+'" title="">' +
					'<input type="hidden" name="day" value="'+day+'">' +
					'<div class="row">' +
						/* '<div class="col-1">' +
							'<img style="height:40px;" class="mt-5 pl-2 img" src="{% static "images/arrow.png" %}">'+
						'</div>'+ */
						'<div class="col">'+
							'<div class="input-group input-group-sm mb-1 pp">' +
			 					'<div class="input-group-prepend">' +
									'<span class="input-group-text placeName" id="inputGroup-sizing-sm">장소</span>' +
								'</div>' +
								'<input type="text" name="place_'+day+'" style="background-color:lightyellow;" class="form-control insertplace" aria-label="Sizing example input" aria-describedby="inputGroup-sizing-sm" placeholder="지도에서 장소를 선택해 주세요" readonly>' +
								'<input type="hidden" name="addr_'+day+'" class="addr">' +
							'</div>' +
							'<div class="input-group input-group-sm mb-1 pp">' +
								'<div class="input-group-prepend">' +
									'<span class="input-group-text placeName" id="inputGroup-sizing-sm">시간</span>' +
								'</div>' +
								'<input type="text" name="time_'+day+'" class="form-control time" aria-label="Sizing example input" aria-describedby="inputGroup-sizing-sm">' +
							'</div>' +
							'<div class="input-group input-group-sm mb-1 memobox'+i+'" style="display:none;">' +
								'<div class="input-group-prepend">' +
									'<span class="input-group-text" id="inputGroup-sizing-sm">메모</span>' +
								'</div>' +
								'<textarea name="memo_'+day+'" class="form-control memo" rows="2" aria-label="Sizing example input" aria-describedby="inputGroup-sizing-sm"></textarea>' +
							'</div>' +
						'</div>' +
					'</div>' +
					'<div class="text-right">' +
						'<input class="memobtn btn btn-outline-info py-0 px-2 mr-1" type="button" onclick="memofunc('+i+')" value="메모">' +
						'<input class="delbtn btn btn-outline-danger py-0 px-2" type="button" onclick="delfunc('+i+')" value="삭제">' +
					'</div>' +
				'</div>'
				);
		
		var len = $(".box").length;
		for(var j=1; j<len+1; j++){
			$(".box:eq("+(j-1)+")").attr("title", j);
		}
		
		i++;
		
	});
	
	//메모버튼 클릭시
	function memofunc(i){
		$(".memobox"+i).slideToggle();
	}
	
	//일정추가탭 삭제클릭시
	function delfunc(i){
		removeMarker3();
		removePath();
		var b = $(".plan"+i).attr("title");
		$(".plan"+i).remove();
		var test2 = [];
		var len = $(".box").length;
		for(var j=1; j<len+1; j++){
			$(".box:eq("+(j-1)+")").attr("title", j);
			var test = j;
				test2.push(test);
		}
		
		
		var c = b;
		
		//alert(test2);
		
		
		hClass_data.splice(c-1, 1);
		coords_data.splice(c-1, 1);
		drawLines.splice(c-1, 1);
		markers3.splice(c-1, 1);
		
		
		console.log(hClass_data);
		console.log(coords_data);
			
		
		for(var k=0;k<hClass_data.length;k++){

			var imageSrc3 = 'https://planner.jeju.com/images/map_icon/pin_SC_'+test2[k]+'.png',
			imageSize3 = new kakao.maps.Size(35, 40),
			imageOption3 = {
			 	spriteSize : new kakao.maps.Size(24, 38), // 스프라이트 이미지의 크기 
			 	offset : new kakao.maps.Point(13, 37)
			};
			
			
			var markerImage3 = new kakao.maps.MarkerImage(imageSrc3, imageSize3, imageOption3)
			var marker3 = new kakao.maps.Marker({
			       map: map,
			       position: coords_data[k],
			       clickable : true,	//마커를 클릭했을 때 지도의 클릭 이벤트가 발생하지 않도록 설정
			       image : markerImage3	//마커 이미지 받기
			});
			markers3.push(marker3);
		}
		
		for(var i=0;i<markers3.length;i++){
			if(i != 0){
				linePath = [coords_data[i-1], coords_data[i]]
				linepaths.splice(i, 1, linePath);
			};
			
		}	
		
		
		
		for(var i=0;i<markers3.length;i++){
			var drawLine = new kakao.maps.Polyline({
				map : map,
				path : linepaths[i-1],	// 1번 위치와 2번 위치가 같이 들어가야함
				strokeWeight : 7,
				strokeColor : 'red',
				strokeStyle : 'solid',
				strokeOpacity : 0.6,
			});
			drawLine.setMap(map);
			drawLines.splice(i-1, 1, drawLine);
			
		}
		console.log(linepaths);
		
			
		mark_num--;
 		i--;
	}

	
	//일정추가탭 확인클릭시
	/* function okfunc(i){
		if($(".plan"+i).find(".insertplace").val() == ""){
			alert("장소를 선택해 주세요");
			return false;
		}else if($(".plan"+i).find(".time").val() == ""){
			alert("시간을 선택해 주세요");
			return false;
		}else{		
			$(".plan"+i).find(".place").attr("readonly", true);
			$(".plan"+i).find(".time").attr("disabled", true);
			$(".plan"+i).find(".memo").attr("readonly", true);
			$(".plan"+i).find(".okbtn").css("display", "none");
			$(".plan"+i).find(".modbtn").css("display", "");
		}
	} */
	
	//일정추가탭 수정 클릭시
	/* function modfunc(i){
		$(".plan"+i).find(".place").attr("readonly", false);
		$(".plan"+i).find(".time").attr("disabled", false);
		$(".plan"+i).find(".memo").attr("readonly", false);
		$(".plan"+i).find(".okbtn").css("display", "");
		$(".plan"+i).find(".modbtn").css("display", "none");
	} */
	
	
	//저장버튼 클릭시
	function formchk(){
		if(!$("input[name='title']").val()){
			alert("제목을 입력해 주세요");
			$("input[name='title']").focus();
			return false;
		}else if(!$("input[name='sdate']").val()){
			alert("시작일을 입력해 주세요");
			$("input[name='sdate']").focus();
			return false;
		}
		
		var val = $(".box:last").find(".insertplace").val();
		var selectDay = $("#planDays option:selected").val();
		var hide2 = $(".day2").find(".box");
		var hide3 = $(".day3").find(".box");
		var hide4 = $(".day4").find(".box");
		var hide5 = $(".day5").find(".box");
		var hide6 = $(".day6").find(".box");
		var hide7 = $(".day7").find(".box");
		
		if(!val){
			//var len = $(".box").find(".insertplace").length;
			alert("값을 전부 입력해 주세요");
			return false;
		}else if(selectDay == 2){
			if(hide2.length == 0){
				alert("여행일수를 확인해 주세요");
				return false;
			}else{
				var conf = confirm("저장하시겠습니까?");
				if(conf){
					$("form[name='planWriteView']").submit();			
				}else{
					return false;
				}
			}
		}else if(selectDay == 3){
			if(hide3.length == 0){
				alert("여행일수를 확인해 주세요");
				return false;
			}else{
				var conf = confirm("저장하시겠습니까?");
				if(conf){
					$("form[name='planWriteView']").submit();			
				}else{
					return false;
				}
			}
		}else if(selectDay == 4){
			if(hide4.length == 0){
				alert("여행일수를 확인해 주세요");
				return false;
			}else{
				var conf = confirm("저장하시겠습니까?");
				if(conf){
					$("form[name='planWriteView']").submit();			
				}else{
					return false;
				}
			}
		}else if(selectDay == 5){
			if(hide5.length == 0){
				alert("여행일수를 확인해 주세요");
				return false;
			}else{
				var conf = confirm("저장하시겠습니까?");
				if(conf){
					$("form[name='planWriteView']").submit();			
				}else{
					return false;
				}
			}
		}else if(selectDay == 6){
			if(hide6.length == 0){
				alert("여행일수를 확인해 주세요");
				return false;
			}else{
				var conf = confirm("저장하시겠습니까?");
				if(conf){
					$("form[name='planWriteView']").submit();			
				}else{
					return false;
				}
			}
		}else if(selectDay == 7){
			if(hide7.length == 0){
				alert("여행일수를 확인해 주세요");
				return false;
			}else{
				var conf = confirm("저장하시겠습니까?");
				if(conf){
					$("form[name='planWriteView']").submit();			
				}else{
					return false;
				}
			}
		}else{
			var conf = confirm("저장하시겠습니까?");
			if(conf){
				$("form[name='planWriteView']").submit();			
			}else{
				return false;
			}
		}
		
		/* $(".box").find(".insertplace").each(function(idx, val){
			var len = $(".box").length;
			//alert($(val).val());
			if($(val).val() == ""){
				alert((i-1)+"번째 장소를 선택해주세요");
				return false;
			}/* else{

				var conf = confirm("저장을 완료 하시겠습니까?");
				if(conf){
					$("form[name='planWriteView']").submit();
				}else{
					return false;
				}
			}

		}); */
	}
	
	</script>
	
	<!-- 모달디자인 -->
	<!-- <div id="modal" style="width:930px;height:755px;position:fixed;top:50%;left:50%;transform:translate(-50%, -50%);z-index:9999;background-color:white;border:2px solid #eee;">
		<button id="close" style="position:absolute;top:-20px;right:-40px;color:black;font-size:3em;border:none;outline:none;background-color:transparent;margin-top:-10px;cursor:pointer;">&times;</button>
		<div id="cont">
			<iframe src="http://place.map.kakao.com/10587024" style="width:925px;height:750px;"></iframe>
		</div>
	</div>
	<script>
		$("#close").click(function(){
			$("#modal").hide();
		});
	</script> -->
<!-- 	http://apis.data.go.kr/B551011/KorService/areaCode?serviceKey=인증키(URL Encode)&areaCode=1&numOfRows=10&pageNo=1&MobileOS=ETC&MobileApp=AppTest -->
{% endblock %}

</html>